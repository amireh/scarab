<% content_for :scripts do %>

  <%= stylesheets "graph" %>
  <%= javascripts "raphael", "kiwi", "kiwi/bheap", "kiwi/graph", "kiwi/node", "kiwi/edge" %>
  
<script>
  
  function print_graph(graph) {
    
    Pixy.Kiwi.cleanup();
    
    $("#meta").empty();
    $("#meta").html("<p>there are <span>" + graph.meta.nr_nodes + "</span> nodes connected by "
      + "<span>" + graph.meta.nr_edges + "</span> edges across <span>"
      + graph.meta.levels + "</span> levels</p>");
    /*
    $("#meta ul").append("<li>" + graph.meta.nr_nodes + " nodes</li>");
    $("#meta ul").append("<li>" + graph.meta.nr_edges + " edges</li>"); 
    $("#meta ul").append("<li>" + graph.meta.levels + " levels</li>");
    */
    Pixy.Kiwi.visualize(graph)
    
    $("#loader .loading").hide();
    $("#canvas").css("background-image", "none");

  };
  
  $(function() {
    
    Pixy.Kiwi.setup();
/*
    Pixy.Kiwi.on_node_click(function(id, level, val) {
      $.ajax({
        type: "GET",
        dataType: 'json',
        url: "/path",
        data: { "id": id, "level": level, "val": val },
        success: function(data) {
        }
      });
    });
*/
    
    var graph = "fack";
    
    
    
    
    $("#generate-graph").click(function() {
/*
      $.getJSON("/graph.json", function(data) {
        graph = data;
        print_graph(graph);
      });
*/
      $.ajax({
        type: "GET",
        dataType: 'json',
        url: "/graph.json",
        beforeSend: function() {
          Pixy.Kiwi.cleanup();
          $("#loader .welcome").hide();
          $("#canvas").css("background", "url('/images/loaders/8.gif') #111 no-repeat center center");
          $("#loader .loading").show();
        },
        success: function(data) {
          
          graph = data;
          setTimeout(print_graph, 1000, graph);
        }
      });

      return false;
      
    });
    
    $("#toggle-weights").click(function() {
      Pixy.Kiwi.toggle_weights();
    });
  });
</script>
  
<% end %>

<div id="graph">
  
  <div id="cpanel" class="cpanel grid_3">
    <h3 class="console_header">Console</h3>
    <div id="meta">
    <!--
      <ul>
      </ul>
    -->
    <p>Graph metadata and other resources will be displayed here.</p>
    </div>
    
    <h3>Controls</h3>
    <ul>
      <li><input type="button" id="generate-graph" value="Generate Graph" /></li>
      <li><input type="button" id="toggle-weights" value="Toggle Edge Weights" /></li>
      <li><input type="button" id="replay-path" disabled="disabled" value="Replay Path" /></li>      
    </ul>

  </div>
  
  <div class="grid_14">
    <div id="loader">
      <span class="loading">..GENERATING..</span>
      <span class="welcome">Use the button to the left to generate<br /> a graph and begin.</span>
    </div>
    <div id="canvas" ></div>
  </div>
</div>

