<% content_for :scripts do %>

  <%= stylesheets "graph" %>
  <%= javascripts "raphael", "kiwi", "kiwi/bheap", "kiwi/graph", "kiwi/node", "kiwi/edge" %>
  
<script>
  
  function print_graph(graph) {
    
    Pixy.Kiwi.cleanup();

    $("#loader .loading").html("..VISUALIZING..");
        
    $("#meta").empty();
    $("#meta").html("<p>there are <span>" + graph.meta.nr_nodes + "</span> nodes connected by "
      + "<span>" + graph.meta.nr_edges + "</span> edges across <span>"
      + graph.meta.levels + "</span> levels</p>");
      
    Pixy.Kiwi.visualize(graph, function() {
      $("#loader .loading").hide();
      $("#canvas").css("background-image", "none");

      $("#toggle-weights").removeClass("disabled");
      $("#choose-heuristic").removeClass("disabled");

    });
    
  };
  
  $(function() {
    
    Pixy.Kiwi.setup();   
    
    $("#generate-graph").click(function() {

      $.ajax({
        type: "GET",
        dataType: 'json',
        url: "/graph.json",
        beforeSend: function() {
          Pixy.Kiwi.cleanup();
          $("#loader .welcome").hide();
          $("#canvas").css("background", "url('/images/loaders/8.gif') #111 no-repeat center center");
          $("#loader .loading").show();
        },
        success: function(data) {
          
          graph = data;
          setTimeout(print_graph, 1000, graph);
        }
      });

      return false;
      
    });
    
    $("#toggle-weights").click(function() {
      Pixy.Kiwi.toggle_weights();
    });
    
    $("#replay-path").click(function() {
      Pixy.Kiwi.graph.highlight_path();
    });
    
  });
</script>
  
<% end %>

<div id="graph">
  
  <div id="cpanel" class="cpanel grid_3">
    <h3 class="console_header">Console</h3>
    <div id="meta">
    <!--
      <ul>
      </ul>
    -->
    <p>Graph metadata and other resources will be displayed here.</p>
    </div>
    
    <div class="controls">
    <h3>Controls</h3>
    <ul>
      <li><a id="generate-graph">Generate Graph</a></li>
      <li><a class="disabled" id="toggle-weights">Toggle Edge Weights</a></li>
      <li><a class="disabled" id="replay-path">Replay Path</a></li>
      <li><a class="disabled" id="choose-heuristic">Choose Heuristic Function</a></li>
    </ul>
    </div>

  </div>
  
  <div class="grid_14">
    <div id="loader">
      <span class="loading">..GENERATING..</span>
      <span class="welcome">Use the button to the left to generate<br /> a graph and begin.</span>
    </div>
    <div id="canvas" ></div>
  </div>
</div>

